<!doctype html>
<html lang="en">
  <head>
    <title>WiiU Video</title>
    <meta charset="utf-8">
    <link href="style/wiivid.css" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="/nowjs/now.js"></script>
    <script src="http://popcornjs.org/code/dist/popcorn-complete.js"></script>
    <script>
    //var mediapath='../video';
    $(document).ready(function(){
      var popcorn=Popcorn('#video');
      now.ready(function(){
        now.sGetList();
        popcorn.footnote({
          /*
          start:2,
          end:5,
          target:'footnote',
          text:'Pop!'
          */
        });
        popcorn.on('ended',function(){
          console.log('video has ended');
          /*
          $($('video').children()[0]).attr('src','http://www.808.dk/pics/video/gizmo.mp4');
          popcorn.load();
          popcorn.play();
          */
        });
      });
      now.cCreateDirectoryList=function(list){
        console.log(list);
        $('#list').empty();
        $.each(list,function(key,dir){
          buildDivTree(dir,$('#list'));
        });
      };
      function buildDivTree(dir,parentDiv){
        var dirdiv=jQuery('<div/>',{text:dir.name+' (subdirs: '+dir.subdirs.length+', vids: '+dir.vids.length+')'}).appendTo(parentDiv);
        dirdiv.addClass('dirdiv');
        var togglediv=jQuery('<div/>',{}).addClass('togglediv');;
        var subdirsdiv=jQuery('<div/>',{}).addClass('subdirsdiv');
        var vidsdiv=jQuery('<div/>',{}).addClass('vidsdiv');;
        dirdiv.click(function(){
          if(subdirsdiv[0].children.length==0&&vidsdiv[0].children.length==0){
            togglediv.appendTo(dirdiv);
            subdirsdiv.appendTo(togglediv);
            vidsdiv.appendTo(togglediv);
            $.each(dir.subdirs,function(key,subdir){
              buildDivTree(subdir,subdirsdiv);
            });
            $.each(dir.vids,function(key,vid){
              var viddiv=jQuery('<div/>',{text:vid.name}).appendTo(vidsdiv);
              viddiv.addClass('viddiv');
              viddiv.on('click',function(){
                $($('video').children()[0]).attr('src',vid.url);
                popcorn.load();
                popcorn.play();
              });
            });
          }else{
            subdirsdiv.empty().remove();
            vidsdiv.empty().remove();
            togglediv.empty().remove();
          }
        }); // end click function
      }

      //$('#userAgent').text(navigator.userAgent);
      if(navigator.userAgent.indexOf('Nintendo WiiU')>0){
        $('body')[0].style.background='#39414A';
        $('body')[0].style.color='#FFFFFF';
        $('#video')[0].style.display='none';
      }
    });
    
    //document.addEventListener('DOMContentLoaded',function(){},false);
    </script>
  </head>
  <body>
    <video id="video" height="180" width="300" controls>
      <!--
      <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.ogv">
      <source src="http://videos.mozilla.org/serv/webmademovies/popcornplug.webm">
      -->
      <source src=""></source>
      Your browser does not support the <code>video</code> element.
    </video>
    <div style="display:none;">
      <button onclick="document.getElementById('video').play()">Play</button>
      <button onclick="document.getElementById('video').pause()">Pause</button>
      <button onclick="document.getElementById('video').volume+=0.1">Volume+</button>
      <button onclick="document.getElementById('video').volume-=0.1">Volume-</button>
    </div>
    <div id="footnote"></div>
    <div id="list">
      <span>Your list is empty.</span>
    </div>
  </body>
</html>